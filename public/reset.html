<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Reset Password</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="p-4">
    <div class="container" style="max-width:560px">
        <h3 class="mb-3">Set a new password</h3>
        <form id="f" class="vstack gap-2">
            <input class="form-control" name="password" type="password" placeholder="New password" required>
            <input class="form-control" name="confirm" type="password" placeholder="Confirm password" required>
            <button class="btn btn-primary" type="submit">Reset password</button>
            <div id="msg" class="small text-danger"></div>
        </form>
        <a href="index.html" class="btn btn-link mt-2">Back</a>
    </div>

    <script>
        ( function ()
        {
            const API = 'http://localhost:3001';
            const token = new URLSearchParams( location.search ).get( 'token' );
            const form = document.getElementById( 'f' );
            const msg = document.getElementById( 'msg' );
            form.addEventListener( 'submit', async ( e ) =>
            {
                e.preventDefault();
                msg.textContent = '';
                const pw = form.password.value.trim();
                const cf = form.confirm.value.trim();
                if ( pw.length < 6 ) { msg.textContent = 'Minimum 6 characters'; return; }
                if ( pw !== cf ) { msg.textContent = 'Passwords do not match'; return; }
                try
                {
                    const r = await fetch( API + '/api/auth/reset', {
                        method: 'POST', headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify( { token, password: pw } )
                    } );
                    const j = await r.json();
                    if ( !r.ok || !j.ok ) { msg.textContent = j.error || 'Reset failed'; return; }
                    msg.classList.remove( 'text-danger' ); msg.classList.add( 'text-success' );
                    msg.textContent = 'Password reset! You can now log in.';
                } catch { msg.textContent = 'Network error'; }
            } );
        } )();
    </script>
</body>

</html>