<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Order Placed • True Purity</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
        body {
            background: #f6fbff
        }

        .cardish {
            background: #fff;
            border: 1px solid rgba(10, 37, 64, .08);
            border-radius: 16px;
            box-shadow: 0 10px 28px rgba(7, 55, 115, .08)
        }

        .brand {
            color: #0D3B66
        }

        .bigcheck {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: #d1fadf;
            color: #0a7a38;
            font-size: 34px
        }

        .mono {
            font-variant-numeric: tabular-nums
        }
    </style>
</head>

<body class="py-5">
    <div class="container" style="max-width: 880px;">
        <div class="text-center mb-4">
            <div class="bigcheck mb-3"><i class="bi bi-check2"></i></div>
            <h2 class="fw-bold brand">Order Successfully Placed</h2>
            <div class="text-muted">Thank you! We’ve received your order and will confirm on WhatsApp shortly.</div>
        </div>

        <div class="cardish p-4">
            <div class="row g-4">
                <div class="col-lg-6">
                    <h5 class="fw-bold">Order Summary</h5>
                    <table class="table table-sm mb-0">
                        <tbody>
                            <tr>
                                <th scope="row" class="w-25">Order #</th>
                                <td class="mono" id="orderId">—</td>
                            </tr>
                            <tr>
                                <th>Model</th>
                                <td id="mModel">—</td>
                            </tr>
                            <tr>
                                <th>Variant</th>
                                <td id="mVariant">—</td>
                            </tr>
                            <tr>
                                <th>Unit Price</th>
                                <td>₹<span id="mPrice">0</span></td>
                            </tr>
                            <tr>
                                <th>Quantity</th>
                                <td id="mQty">1</td>
                            </tr>
                            <tr class="fw-semibold">
                                <th>Total</th>
                                <td>₹<span id="mTotal">0</span></td>
                            </tr>
                            <tr>
                                <th>Payment</th>
                                <td id="mPayment">—</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-lg-6">
                    <h5 class="fw-bold">Customer Details</h5>
                    <table class="table table-sm mb-0">
                        <tbody>
                            <tr>
                                <th scope="row" class="w-25">Name</th>
                                <td id="mName">—</td>
                            </tr>
                            <tr>
                                <th>Phone</th>
                                <td id="mPhone">—</td>
                            </tr>
                            <tr>
                                <th>Address</th>
                                <td id="mAddress">—</td>
                            </tr>
                            <tr>
                                <th>City</th>
                                <td id="mCity">—</td>
                            </tr>
                            <tr>
                                <th>Pincode</th>
                                <td id="mPincode">—</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="d-flex gap-2 mt-4">
                <a class="btn btn-primary" href="index.html">Back to Home</a>
                <a class="btn btn-outline-secondary" id="printBtn" href="#">Print / Save PDF</a>
            </div>
        </div>
    </div>
    <script>
        ( function ()
        {
            const API_BASE = window.location.origin; // http://localhost:3001
            const p = new URLSearchParams( location.search );
            const id = p.get( 'id' );
            const rupee = n => Number( n || 0 ).toLocaleString( 'en-IN' );

            function paymentLabel ( row )
            {
                // If the order ultimately got marked paid, show Paid
                if ( row.status === 'paid' )
                {
                    const pid = row.razorpay_payment_id ? ` — ${ row.razorpay_payment_id }` : '';
                    return `Online (Razorpay) — Paid${ pid }`;
                }
                // If order was initiated via Razorpay but not paid yet
                if ( row.payment_mode === 'razorpay' )
                {
                    return 'Online (Razorpay) — Pending';
                }
                // Default to COD style
                const pretty = ( row.payment_mode || 'cod' ).toUpperCase();
                return pretty === 'COD' ? 'Cash / Card on Delivery (COD)' : pretty;
            }

            async function renderFromDb ( row )
            {
                document.getElementById( 'orderId' ).textContent = row.order_no || ( 'TP' + row.id );
                document.getElementById( 'mModel' ).textContent = row.model;
                document.getElementById( 'mVariant' ).textContent = row.variant;
                document.getElementById( 'mPrice' ).textContent = rupee( row.unit_price );
                document.getElementById( 'mQty' ).textContent = row.qty;
                document.getElementById( 'mTotal' ).textContent = rupee( row.total );
                document.getElementById( 'mPayment' ).textContent = paymentLabel( row );
                document.getElementById( 'mName' ).textContent = row.name;
                document.getElementById( 'mPhone' ).textContent = row.phone;
                document.getElementById( 'mAddress' ).textContent = row.address;
                document.getElementById( 'mCity' ).textContent = row.city;
                document.getElementById( 'mPincode' ).textContent = row.pincode;
            }

            async function main ()
            {
                if ( id )
                {
                    const r = await fetch( `${ API_BASE }/api/orders/${ id }` ).then( r => r.json() );
                    if ( !r || r.error ) { alert( 'Order not found' ); return; }
                    await renderFromDb( r );
                } else
                {
                    // Fallback to query params (older flow)
                    const ru = x => rupee( p.get( x ) );
                    document.getElementById( 'orderId' ).textContent = 'TP' + new Date().toISOString().replace( /[-:TZ.]/g, '' ).slice( 0, 14 );
                    document.getElementById( 'mModel' ).textContent = p.get( 'model' ) || '—';
                    document.getElementById( 'mVariant' ).textContent = p.get( 'variant' ) || '—';
                    document.getElementById( 'mPrice' ).textContent = ru( 'price' );
                    document.getElementById( 'mQty' ).textContent = p.get( 'qty' ) || '1';
                    document.getElementById( 'mTotal' ).textContent = ru( 'total' );
                    document.getElementById( 'mPayment' ).textContent = p.get( 'payment' ) || '—';
                    document.getElementById( 'mName' ).textContent = p.get( 'name' ) || '—';
                    document.getElementById( 'mPhone' ).textContent = p.get( 'phone' ) || '—';
                    document.getElementById( 'mAddress' ).textContent = p.get( 'address' ) || '—';
                    document.getElementById( 'mCity' ).textContent = p.get( 'city' ) || '—';
                    document.getElementById( 'mPincode' ).textContent = p.get( 'pincode' ) || '—';
                }
            }

            document.getElementById( 'printBtn' )?.addEventListener( 'click', e => { e.preventDefault(); window.print(); } );
            main();
        } )();
    </script>

</body>

</html>